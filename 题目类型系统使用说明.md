# 题目类型系统使用说明

## 概述

OJ系统现在支持多种题目类型，每种类型都有不同的界面和判题逻辑：

- **编程题 (programming)**：传统的代码编程题目
- **选择题 (choice)**：单选或多选题目
- **判断题 (judge)**：判断对错的题目
- **简答题 (short_answer)**：文本答案题目

## 前端界面

### 1. 题目详情页 (`ProblemDetailPage.js`)

根据题目类型自动显示不同的界面：

#### 编程题
- 显示输入输出示例
- 代码编辑器
- 编程语言选择
- 时间/内存限制信息

#### 选择题
- 选项列表（A、B、C、D...）
- 单选或多选（根据 `is_multiple_choice` 字段）
- 选项内容从 `test_cases` 字段解析

#### 判断题
- "正确"和"错误"两个选项
- 单选按钮形式

#### 简答题
- 文本输入框
- 支持多行输入

### 2. 测试页面 (`/test`)

访问 `/test` 路径可以查看测试页面，包含：
- 不同题型的示例题目
- 题目类型筛选器
- 快速跳转到题目详情页

## 后端支持

### 1. 题目模型 (`Problem`)

```python
class Problem(db.Model):
    type = db.Column(db.String(20), default='programming')  # 题目类型
    test_cases = db.Column(db.Text, nullable=True)          # 测试用例/选项
    expected_output = db.Column(db.Text, nullable=True)     # 期望输出/答案
    # ... 其他字段
```

### 2. 判题服务 (`judge.py`)

支持所有题目类型的自动判题：

- **编程题**：执行代码，比较输出
- **选择题**：比较选择的答案
- **判断题**：比较判断结果
- **简答题**：关键词匹配（60%匹配度算正确）

### 3. API端点

- `GET /problems/<id>` - 获取题目详情
- `POST /submit` - 提交答案/代码
- `GET /result/<id>` - 获取判题结果

## 使用方法

### 1. 创建题目

#### 编程题
```json
{
  "title": "Hello World",
  "description": "输出Hello World",
  "type": "programming",
  "test_cases": "无输入",
  "expected_output": "Hello World",
  "difficulty": "easy",
  "time_limit": 1000,
  "memory_limit": 128
}
```

#### 选择题
```json
{
  "title": "选择题示例",
  "description": "以下哪个是编程语言？",
  "type": "choice",
  "test_cases": "Python\nJava\nC++\nJavaScript",
  "expected_output": "A,B,C,D",
  "difficulty": "easy"
}
```

#### 判断题
```json
{
  "title": "判断题示例",
  "description": "Python是一种解释型语言。",
  "type": "judge",
  "expected_output": "正确",
  "difficulty": "easy"
}
```

#### 简答题
```json
{
  "title": "简答题示例",
  "description": "请简述什么是面向对象编程？",
  "type": "short_answer",
  "expected_output": "封装,继承,多态",
  "difficulty": "medium"
}
```

### 2. 提交答案

#### 编程题
```json
{
  "problem_id": 1,
  "code": "print('Hello World')",
  "language": "python"
}
```

#### 选择题
```json
{
  "problem_id": 2,
  "code": "A,B,C,D",
  "language": "choice"
}
```

#### 判断题
```json
{
  "problem_id": 3,
  "code": "正确",
  "language": "judge"
}
```

#### 简答题
```json
{
  "problem_id": 4,
  "code": "面向对象编程是一种编程范式...",
  "language": "short_answer"
}
```

## 数据字段说明

### `type` 字段
- `programming` - 编程题
- `choice` - 选择题
- `judge` - 判断题
- `short_answer` - 简答题

### `test_cases` 字段
- **编程题**：输入测试用例
- **选择题**：选项列表（每行一个选项）
- **判断题**：可以为空
- **简答题**：可以为空

### `expected_output` 字段
- **编程题**：期望输出
- **选择题**：正确答案（如 "A,B,C,D"）
- **判断题**：正确答案（"正确" 或 "错误"）
- **简答题**：关键词列表（逗号分隔）

## 测试和调试

### 1. 访问测试页面
```
http://localhost:3000/test
```

### 2. 查看不同题型
- 点击题目类型按钮筛选
- 点击"查看详情"进入题目详情页
- 测试不同题型的界面显示

### 3. 后端日志
判题服务会输出详细的判题过程日志，包括：
- 题目类型识别
- 判题逻辑执行
- 结果判断过程

## 注意事项

1. **数据库更新**：确保数据库模型已更新，包含 `type` 字段
2. **判题服务**：重启判题服务以加载新的判题逻辑
3. **题目创建**：创建题目时正确设置 `type` 字段
4. **答案格式**：确保答案格式与判题逻辑匹配

## 扩展功能

### 1. 自定义判题逻辑
可以在 `judge.py` 中添加更复杂的判题算法：
- 相似度计算
- 模糊匹配
- 语义分析

### 2. 新的题目类型
添加新的题目类型：
1. 在模型中添加类型
2. 在前端添加界面
3. 在判题服务中添加逻辑

### 3. 批量导入
支持从Excel文件批量导入不同题型的题目

## 故障排除

### 常见问题

1. **题目类型显示错误**
   - 检查数据库中的 `type` 字段值
   - 确认前端正确解析题目类型

2. **判题失败**
   - 检查判题服务是否运行
   - 查看后端日志错误信息

3. **界面显示异常**
   - 检查CSS样式是否正确加载
   - 确认React组件状态管理

### 调试技巧

1. 使用浏览器开发者工具查看网络请求
2. 检查后端日志输出
3. 使用测试页面验证功能
4. 查看数据库中的题目数据

---

如有问题，请查看后端日志或联系开发团队。
